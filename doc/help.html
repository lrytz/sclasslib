<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>jclasslib bytecode viewer help</title><link type="text/css" href="doc.css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.49" name="generator"><meta name="description" content="a library for viewing and manipulating java bytecode"><meta name="keywords" content="jclasslib, bytecode, performance, profiling, instrumentation, profiler, java, classes"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><img src="images/jclasslib.jpg" width="287" height="97" alt="jclasslib logo"></td><td align="right"><a href="http://www.ej-technologies.com"><img border="0" src="images/ej-technologies.gif" width="290" height="80" alt="ej-technologies logo"></a></td></tr></table><div class="article"><div class="titlepage"><div style="margin-left:18px"><h2 class="title"><a name="N10001"></a>jclasslib bytecode viewer help</h2></div><div style="margin-left:18px"><h3 class="subtitle"><i>ej-technologies GmbH, Ingo Kegel, 2003-08-20</i></h3></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="#N10007">Sponsor</a></dt><dt><a href="#N10024">Purpose</a></dt><dt><a href="#N10031">Installing the jclasslib bytecode viewer</a></dt><dd><dl><dt><a href="#N10037">Requirements</a></dt><dt><a href="#N10044">Installing from binary distribution</a></dt><dt><a href="#N1004D">Installing as Netbeans module</a></dt><dt><a href="#N10067">Building jclasslib from source</a></dt></dl></dd><dt><a href="#N10107">The bytecode viewer</a></dt><dd><dl><dt><a href="#N1010A">Starting the bytecode viewer</a></dt><dt><a href="#N10129">Using the bytecode viewer</a></dt><dt><a href="#N101EA">The bytecode viewer as a Netbeans module</a></dt></dl></dd><dt><a href="#N10201">The bytecode manipulation library</a></dt><dd><dl><dt><a href="#N10204">UML diagrams of jclasslib</a></dt><dt><a href="#N10244">Debugging reading and writing of class files</a></dt><dt><a href="#N10263">Using jclasslib in your own application</a></dt></dl></dd><dt><a href="#N102A7">Trademarks</a></dt></dl></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="N10007"></a>Sponsor</h2></div></div><p>
      The development of the <i>jclasslib bytecode viewer</i> is sponsored by
      <a href="http://www.ej-technologies.com" target="_top">ej-technologies GmbH</a>.
      
      <div class="itemizedlist"><ul type="disc"><li><p>
            If you are working with Java bytecode, you might also be interested in
            <a href="http://www.ej-technologies.com/products/jprofiler/overview.html" target="_top">JProfiler</a>,
            an all-purpose Java profiling suite.
          </p></li><li><p>
            If you have to deploy Java GUI or server applications, you might also be interested in
            <a href="http://www.ej-technologies.com/products/install4j/overview.html" target="_top">install4j</a>,
            a multi-platform Java installer builder.
          </p></li></ul></div>
    </p></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="N10024"></a>Purpose</h2></div></div><p>
      <i>jclasslib</i> is a Java class file library that can be used
      to read, modify and write class files.
      The <i>jclasslib bytecode viewer</i> displays class files and
      bytecode and lets you navigate through the class file structure in a browser-like fashion.
      While the bytecode manipulation part is of interest to developers with
      specialized development targets such as obfuscators, compilers or code completion
      engines, the bytecode viewer is a standalone application which is useful for
      anyone trying to understand the java virtual machine.
    </p></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="N10031"></a>Installing the <i>jclasslib bytecode viewer</i></h2></div></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10037"></a>Requirements</h3></div></div><p>
        To run the <i>jclasslib bytecode viewer</i> you need
        a Java 1.4 runtime environment or higher, available at
        <a href="http://java.sun.com/j2se/" target="_top">http://java.sun.com/j2se/</a>.
      </p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10044"></a>Installing from binary distribution</h3></div></div><p>
        The <i>jclasslib bytecode viewer</i> is provided as a Windows 
        installer or as a gzipped tar archive. Besides unpacking it at a suitable location,
        no further steps are necessary for the installation. Specifically, no external
        libraries and classpath settings are necessary.
      </p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N1004D"></a>Installing as Netbeans module</h3></div></div><p>
        To install the bytecode viewer as a Netbeans module, double click on
        <tt>jclasslib.nbm</tt> in Windows, or perform the following steps in
        the Netbeans IDE:
        <i>Tools</i>-&gt;<i>Update Center</i>
        and select
        <b>[</b><b>Install Manually Downloaded Modules (*.nbm files)</b><b>]</b>. Add
        the file <tt>jclasslib.nbm</tt> in the next step and complete the
        remaining steps of the installation wizard.
      </p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10067"></a>Building <i>jclasslib</i> from source</h3></div></div><p>
        To build <i>jclasslib</i>, you need the
        <i>ant</i> build tool (&gt;= 1.5) available at
        <a href="http://ant.apache.org" target="_top">http://ant.apache.org/</a>.
        If you want to build this documentation, you have to
        install the dcobook DTD and stylesheets. This is done in three steps:
        <p>
          <div class="orderedlist"><ol type="1"><li><p>
                Create a directory <tt>docbook</tt> in <tt>doc/src</tt>
                under the <i>jclasslib</i> root. In this new directory, create
                the subdirectories <tt>dtd</tt> and <tt>stylesheets</tt>.
              </p></li><li><p>
                download the Docbook XML DTD version 4.1.2 from
                <a href="http://www.oasis-open.org/docbook/xml/index.shtml" target="_top">
                http://www.oasis-open.org/docbook/xml/index.shtml</a>
                and unpack contents of this zip file directly to the
                <tt>dtd</tt> directory created in step 1.
              </p></li><li><p>
                download the Docbook XSL stylesheets from
                <a href="http://sourceforge.net/project/showfiles.php?group_id=21935" target="_top">
                http://sourceforge.net/project/showfiles.php?group_id=21935</a>
                and unpack the zip file to the <tt>stylesheets</tt> directory created
                in step 1. Rename the first directory which contains all the other files
                to <tt>docbook</tt>.
              </p></li></ol></div>
        </p>
      </p><p>
        The following ant targets are used for building <i>jclasslib</i>:
        <div class="informaltable"><table border="1"><colgroup><col align="center"><col align="left"></colgroup><thead><tr><th align="center">ant target</th><th align="left">purpose</th></tr></thead><tbody><tr><td align="center">compile (default)</td><td align="left">compile java files to the <tt>build</tt> directory</td></tr><tr><td align="center">jar</td><td align="left">create jar file in the <tt>build</tt> directory</td></tr><tr><td align="center">doc</td><td align="left">
                  build this documentation in the <tt>doc</tt> directory
                </td></tr><tr><td align="center">javadoc</td><td align="left">
                  build the javadoc documentation in the <tt>doc/api</tt> directory
                </td></tr><tr><td align="center">dist</td><td align="left">
                  build a distribution of <i>jclasslib</i> in the
                  <tt>dist</tt> directory. The distribution is created with
                  <i>install4j</i> available at
                  <a href="http://www.ej-technologies.com/products/install4j/overview.html" target="_top">
                  http://www.ej-technologies.com/products/install4j/overview.html</a>.
                </td></tr><tr><td align="center">clean</td><td align="left">cleans all generated files and directories</td></tr></tbody></table></div>
      </p></div></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="N10107"></a>The bytecode viewer</h2></div></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N1010A"></a>Starting the bytecode viewer</h3></div></div><p>
        Application launchers for Microsoft Windows (<tt>jclasslib.exe</tt>)
        and UNIX (<tt>jclasslib</tt>) are available. 
        The bytecode viewer can also be run by entering
        <div class="cmdsynopsis"><p><tt>java -jar jclasslib.jar</tt> </p></div>
        at the command line with the current director at the
        <i>jclasslib</i> root. If you want to use the jclasslib bytecode viewer
        with the default look and feel instead of the native look and feel, pass the VM parameter
        <tt>jclasslib.laf.default=true</tt> to the application. For the Windows launcher,
        this is done by passing <tt>-J-Djclasslib.laf.default=true</tt> as an argument.
      </p><p>
        As an argument, you can pass either the path of a workspace file or the path
        of a single class file to be opened on startup.
      </p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10129"></a>Using the bytecode viewer</h3></div></div><p>
        The bytecode viewer allows you to open class files and jar archives 
        (not java files!) with
        <i>File</i>-&gt;<i>Open class file</i>.
        Class files will be displayed in child windows which are initially maximized.
        If you select a jar file, a tree will be displayed which lets you to
        select a class contained within the archive. 
        As you open class files, the classpath will be automatically updated.
        You can edit the classpath by choosing
        <i>Classpath</i>-&gt;<i>Setup classpath</i>.
        You can also choose a class from the currently configured classpath by
        choosing
        <i>Classpath</i>-&gt;<i>Browse classpath</i>
        and selecting the desired class from the classpath tree.
        The classpath for a new workspace initially consists of the runtime 
        library of the JRE that is used to run the bytecode viewer.
      </p><p>
        The currently configured classpath, the currently opened classes, the window
        positions and the currently selected detail panes for each class constitute
        a workspace. Workspaces can be saved and loaded with the 
        <i>File</i>-&gt;<i>Save workspace</i>
        and
        <i>File</i>-&gt;<i>Open Workspace</i>
        actions. A list of the 10 last used workspaces is displayed in the
        <i>File</i>+<i>Reopen Workspace</i>
        menu.
      </p><p>
        As you navigate through constant pool entries and branch offsets in a class,
        the backward and forward actions will become available. In this way, you can
        for example examine the details of a constant pool entry and then easily return 
        to the bytecode you were looking at.
        If you recompile the class while having it opened in the bytecode viewer,
        you can reload the class file with
        <i>Browse</i>-&gt;<i>Reload</i> (<b>CTRL-R</b>).
      </p><p>
        The information contained in a class file are accessible via the tree
        in the left side of the window, closely mirroring the structures as defined
        in the Java virtual machine specification. The panel to the right side of
        the tree displays details contained in the selected structure. Green underlined
        entries are hyperlinks, which lead to a different structure in the tree or to
        a different offset in a code structure. Red entries - prefixed by verbose
        explanations in normal font - are values contained in a particular fields of
        a structure.
      </p><p>
        The detail view of any attribute structure is always composed of two areas:
      </p><p>
        <div class="itemizedlist"><ul type="disc"><li><p>
              The <span class="emphasis"><i>generic info</i></span> pane showing fields that apply to
              all attribute structures.
            </p></li><li><p>
              The <span class="emphasis"><i>specific info</i></span> pane showing fields that apply only to
              the specified attribute structure.
            </p></li></ul></div>
      </p><p>
        The main sections of the class file structure tree are:
        <div class="variablelist"><dl><dt><span class="term">General Information</span></dt><dd><p>
              All fields without sub-structure directly contained in the class file
              structure.
            </p></dd><dt><span class="term">Constant pool</span></dt><dd><p>
              The runtime constant pool of the class file. All entries are named as
              suggested in the Java virtual machine specification and are hyperlinked
              where appropriate. For class references, method references, interface
              method references and field references a <b>[</b><b>Show</b><b>]</b> button
              is displayed that displays the referenced class or class member. If the 
              referenced class is not the currently displayed class, the bytecode viewer
              will try to locate the class in the currently configured class path and
              open it in a new window. If the class is already opened, the existing
              window will be activated. If the class can not be located, you get a
              chance to edit the classpath and try again.
            </p></dd><dt><span class="term">Interfaces</span></dt><dd><p>
              All interfaces which are implemented by the class described by the class
              file numbered from <tt>0</tt> to <tt>n - 1</tt>.
            </p></dd><dt><span class="term">Fields</span></dt><dd><p>
              All fields of the class described by the class file.
            </p></dd><dt><span class="term">Fields</span></dt><dd><p>
              All fields of the class described by the class file. Fields entries may
              themselves be nodes and contain a <tt>ConstantValue</tt> attribute.
            </p></dd><dt><span class="term">Methods</span></dt><dd><p>
              All methods of the class described by the class file. Method entries contain
              at least a <tt>Code</tt> attribute. The specific info part of the
              detail view of a code attribute contains a tabbed pane with 3 tabs showing
            </p><p>
              <div class="itemizedlist"><ul type="disc"><li><p>
                    the bytecode in a somewhat modified assembly notation like the one
                    produced by <i>javap</i>. The left gutter shows line numbers
                    in small font. The red numbers at the start of each line
                    show the byte offset of the opcode in the current
                    method. Constant pool entries are hyperlinks denoted as <tt>#nnn</tt>,
                    links to other offset such as in branching instructions are hyperlinks denoted
                    as <tt>nnn</tt>.
                  </p></li><li><p>
                    the exception table pertaining to the bytecode.
                  </p></li><li><p>
                    other fields of the code attribute structure without further sub-structure.
                  </p></li></ul></div>
            </p><p>
              The <tt>Code</tt> attribute usually contains other attributes itself and is
              therefore a node in the tree.
            </p></dd></dl></div>
      </p><p>
        To understand the meaning of the classfile structure, its substructures and the bytecode itself,
        it is useful to have the <a href="http://java.sun.com/docs/books/vmspec/" target="_top">Java virtual machine
        specification</a> at hand.
      </p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N101EA"></a>The bytecode viewer as a Netbeans module</h3></div></div><p>
        To open a class file in Netbeans, the first step is to either select a java source node
        or a class file node in the explorer or to activate a Java source file in the source editor.
        Java sources have to be compiled in order for the bytecode viewer menu entries to be 
        available. The second step is to either right click and navigate to
        <i>Tools</i>-&gt;<i>View class file</i>
        in the popup menu or to execute
        <i>Tools</i>-&gt;<i>View class file</i>
        in the main Netbeans menu.
      </p></div></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="N10201"></a>The bytecode manipulation library</h2></div></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10204"></a><a name="uml"></a>UML diagrams of <i>jclasslib</i></h3></div></div><p>
        The following UML diagrams for the bytecode manipulation library packages contained in
        <tt>org.gjt.jclasslib</tt> and its subpackages give an overview
         of the general architecture.
      </p><div class="itemizedlist"><ul type="disc"><li><p>
            <a href="images/bytecode.gif" target="_top">
            <tt>org.gjt.jclasslib.bytecode</tt>
            </a>
          </p></li><li><p>
            <a href="images/io.gif" target="_top">
            <tt>org.gjt.jclasslib.io</tt>
            </a>
          </p></li><li><p>
            <a href="images/structures.gif" target="_top">
            <tt>org.gjt.jclasslib.structures</tt>
            </a>
          </p></li><li><p>
            <a href="images/structures_attributes.gif" target="_top">
            <tt>org.gjt.jclasslib.structures.attributes</tt>
            </a>
          </p></li><li><p>
            <a href="images/structures_constants.gif" target="_top">
            <tt>org.gjt.jclasslib.structures.constants</tt>
            </a>
          </p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10244"></a>Debugging reading and writing of class files</h3></div></div><p>
        To see extensive debugging on stdout while <i>jclasslib</i> reads or
        writes class files, set the JVM environment variable
        <tt>org.gjt.jclasslib.structures.AbstractStructure.SYSTEM_PROPERTY_DEBUG</tt>
        (= <tt>jclasslib.io.debug</tt>) to <tt>true</tt> either by passing
        <tt>-Djclasslib.io.debug=true</tt> right after the the <tt>java</tt>
        command in the invokation of the apllication of by setting the property via
        <tt>System.setProperty</tt>.
      </p></div><div class="sect2"><div class="titlepage"><div><h3 class="title"><a name="N10263"></a>Using <i>jclasslib</i> in your own application</h3></div></div><p>
        To use <i>jclasslib</i> in your own application you need
        to look at the javadoc documentation and at the source. Here are a few hints
        on how to begin:
      </p><p>
        <div class="itemizedlist"><ul type="disc"><li><p>
              The single most important class is the
              <tt>org.gjt.jclasslib.structures.ClassFile</tt> class. All other
              structures defined in the class file format are hooked up here.
            </p></li><li><p>
              Reading and writing class files is done with the
              <tt>org.gjt.jclasslib.io.ClassFileReader</tt> and
              <tt>org.gjt.jclasslib.io.ClassFileWriter</tt> classes.
            </p></li><li><p>
              Bytecode is not translated to java classes within a <tt>ClassFile</tt>
              structure. To manipulate bytecode as a sequence of opcodes the
              <tt>org.gjt.jclasslib.io.ByteCodeReader</tt> and
              <tt>org.gjt.jclasslib.io.ByteCodeWriter</tt> classes can be used to convert
              the bytecode between classes of the <tt>org.gjt.jclasslib.bytecode</tt>
              package and <tt>byte[]</tt> arrays as returned and expected by the
              <tt>ClassFile</tt> structure.
            </p></li><li><p>
              Inserting your own instructions into existing bytecode is done by creating
              a list of instances of <tt>org.gjt.jclasslib.io.CodeInsertion</tt>
              and invoking the <tt>org.gjt.jclasslib.io.CodeInsertion.apply</tt>
              method. This way, bytecode offsets of branch instructions are shifted 
              to take account for the inserted instructions. Dependant structures such as
              line number and exception table are updated as well.
            </p></li><li><p>
              Manipulation of the constant pool is most conveniently done via the 
              <tt>org.gjt.jclasslib.structures.ConstantPoolUtil</tt> class.
              With its static methods, you can insert higher-level constant pool entries
              which require other constant pool entries to be genererated
              with only one method call.
            </p></li></ul></div>
      </p></div></div><div class="sect1"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="N102A7"></a>Trademarks</h2></div></div><p>
      <div class="itemizedlist"><ul type="disc"><li><p>
            Sun, Sun Microsystems and Java are registered trademarks of Sun Microsystems, Inc.
            in the United States and other countries.
          </p></li><li><p>
            Microsoft and Microsoft Windows are registered trademarks of Microsoft Corporation,
            registered in the U.S. and other countries.
          </p></li></ul></div>
    </p></div></div></body></html>